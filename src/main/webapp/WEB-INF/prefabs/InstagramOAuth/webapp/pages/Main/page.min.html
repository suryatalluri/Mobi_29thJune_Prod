<style id="Main.css">
.wm-app .instagram-login-btn, .wm-app .instagram-login-btn:hover {
    background-color : #125688;
    color: #fff;
}
.wm-app .instagram-login-btn .btn-caption:not(:empty) {
    border-left: 0.5px solid rgba(255, 255, 255, 0.34);
    padding-left: 5px;
}
</style>
<script id="Main.js">
Application.$controller("InstagramOAuthController", ["$scope", "Utils", function($scope, Utils) {
    "use strict";
    var LOGIN_MODE = {
            'AUTOMATIC': "auto"
        },
        autoLogin = $scope.loginmode === LOGIN_MODE.AUTOMATIC;

    $scope.isInsideIframe = window.self != window.top;
    /*
     * This function will be invoked when any of this prefab's property is changed
     * @key: property name
     * @newVal: new value of the property
     * @oldVal: old value of the property
     */
    function propertyChangeHandler(key, newVal, oldVal) {
            /*
             switch (key) {
             case "prop1":
             // do something with newVal for property 'prop1'
             break;
             case "prop2":
             // do something with newVal for property 'prop2'
             break;
             }
             */

        }
        /* register the property change handler */
    $scope.propertyManager.add($scope.propertyManager.ACTIONS.CHANGE, propertyChangeHandler);

    function toggleSignInButton(enable) {
        var signInBtn = $scope.Widgets.signInButton.$element;
        if (!enable) {
            signInBtn.attr('disabled', 'disabled');
        } else {
            signInBtn.removeAttr('disabled');
        }
    }

    function openWindow(href) {
        if (!href) {
            return;
        }
        window.open(href, $scope.isInsideIframe ? '_blank' : '_self', "width=550,height=700");
    }

    function login() {
        $scope.Widgets.signInButton.$element.click();
    }

    $scope.onInitPrefab = function() {
        $scope.login = login;
    };

    $scope.signInButtonClick = function($event, $isolateScope) {
        openWindow($scope.loginurl);
    };

    $scope.getAccessTokenonSuccess = function(variable, data) {
        var callbackParams;
        if (data) {
            $scope.accesstoken = data;
            $scope.Widgets.signInButton.disabled = true;
            toggleSignInButton(false);
            if ($scope.loginsuccessmessage) {
                $scope.Variables.loginSuccess.invoke();
            }
            Utils.triggerFn($scope.onLoginsuccess);
        } else {
            if ($scope.isInsideIframe) {
                callbackParams = JSON.stringify({
                    'WMOAuthState': true
                });
            } else {
                callbackParams = "csrf8888";
            }
            $scope.Variables.getLoginURL.setInput('state', callbackParams);
            $scope.Variables.getLoginURL.invoke();
        }
    };


    $scope.getLoginURLonSuccess = function(variable, data) {
        $scope.loginurl = data;
        toggleSignInButton(!$scope.accesstoken);
        if (autoLogin && !$scope.accesstoken) {
            openWindow(data);
        }
    };


    $scope.getCallbackURLonSuccess = function(variable, data) {
        $scope.callbackurl = data;
    };

}]);
</script>
<script id="Main.variables.json">
var _MainPage_Variables_ ={
  "callback" : {
    "_id" : "wm-callback-wm.ServiceVariable-1488432564186",
    "name" : "callback",
    "owner" : "Page",
    "category" : "wm.ServiceVariable",
    "dataBinding" : [ ],
    "service" : "OAuthHandlerService",
    "operation" : "callback",
    "operationId" : "OAuthHandlerController_callback",
    "operationType" : "get",
    "serviceType" : "JavaService",
    "dataSet" : [ ],
    "isList" : false,
    "maxResults" : 20,
    "designMaxResults" : 10,
    "startUpdate" : false,
    "autoUpdate" : true,
    "inFlightBehavior" : "executeLast",
    "transformationRequired" : false,
    "saveInPhonegap" : false,
    "controller" : "OAuthHandler"
  },
  "getAccessToken" : {
    "_id" : "wm-getAccessToken-wm.ServiceVariable-1488432253723",
    "name" : "getAccessToken",
    "owner" : "Page",
    "category" : "wm.ServiceVariable",
    "dataBinding" : [ ],
    "type" : "string",
    "service" : "OAuthHandlerService",
    "operation" : "getAccessToken",
    "operationId" : "OAuthHandlerController_getAccessToken",
    "operationType" : "get",
    "serviceType" : "JavaService",
    "dataSet" : [ ],
    "isList" : false,
    "maxResults" : 20,
    "designMaxResults" : 10,
    "onSuccess" : "getAccessTokenonSuccess($event, $scope)",
    "startUpdate" : true,
    "autoUpdate" : true,
    "inFlightBehavior" : "executeLast",
    "transformationRequired" : false,
    "saveInPhonegap" : false,
    "controller" : "OAuthHandler"
  },
  "getCallbackURL" : {
    "_id" : "wm-getCallbackURL-wm.ServiceVariable-1488432617675",
    "name" : "getCallbackURL",
    "owner" : "Page",
    "category" : "wm.ServiceVariable",
    "dataBinding" : [ ],
    "type" : "string",
    "service" : "OAuthHandlerService",
    "operation" : "getCallbackURL",
    "operationId" : "OAuthHandlerController_getCallbackURL",
    "operationType" : "get",
    "serviceType" : "JavaService",
    "dataSet" : [ ],
    "isList" : false,
    "maxResults" : 20,
    "designMaxResults" : 10,
    "onSuccess" : "getCallbackURLonSuccess($event, $scope)",
    "startUpdate" : true,
    "autoUpdate" : true,
    "inFlightBehavior" : "executeLast",
    "transformationRequired" : false,
    "saveInPhonegap" : false,
    "controller" : "OAuthHandler"
  },
  "getLoginURL" : {
    "_id" : "wm-getLoginURL-wm.ServiceVariable-1488432662971",
    "name" : "getLoginURL",
    "owner" : "Page",
    "category" : "wm.ServiceVariable",
    "dataBinding" : [ ],
    "type" : "string",
    "service" : "OAuthHandlerService",
    "operation" : "getLoginURL",
    "operationId" : "OAuthHandlerController_getLoginURL",
    "operationType" : "get",
    "serviceType" : "JavaService",
    "dataSet" : [ ],
    "isList" : false,
    "maxResults" : 20,
    "designMaxResults" : 10,
    "onSuccess" : "getLoginURLonSuccess($event, $scope)",
    "startUpdate" : false,
    "autoUpdate" : false,
    "inFlightBehavior" : "executeLast",
    "transformationRequired" : false,
    "saveInPhonegap" : false,
    "controller" : "OAuthHandler"
  },
  "loginSuccess" : {
    "_id" : "wm-loginSuccess-wm.NotificationVariable-1488432811229",
    "name" : "loginSuccess",
    "owner" : "Page",
    "category" : "wm.NotificationVariable",
    "dataBinding" : [ {
      "target" : "content",
      "value" : "inline",
      "type" : "string"
    }, {
      "target" : "duration",
      "value" : "3000",
      "type" : "number"
    }, {
      "target" : "class",
      "value" : "Success",
      "type" : "string"
    } ],
    "operation" : "toast"
  },
  "supportedLocale" : {
    "_id" : "wm-wm.Variable1402640443182",
    "name" : "supportedLocale",
    "owner" : "Page",
    "category" : "wm.Variable",
    "dataSet" : {
      "en" : "English"
    },
    "type" : "string",
    "isList" : false,
    "saveInPhonegap" : false
  }
}
</script>
<script id="Main.html" type="text/ng-template">
<wm-page name="page1" data-ng-controller="InstagramOAuthController">
    <wm-content name="view1">
        <wm-button on-click="signInButtonClick($event, $scope)" ng-class="buttonclass" caption="bind:buttoncaption" type="button" name="signInButton" iconclass="fa fa-instagram fa-lg" show="true" class="btn instagram-login-btn"></wm-button>
    </wm-content>
</wm-page>
</script>